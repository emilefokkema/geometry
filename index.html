<html>
<head>
<LINK href="geometry.css" rel="stylesheet" type="text/css" />
</head>
<body style="margin:0px;padding:0px">
<script src="makeModule.js"></script>
<script src="makeNode.js"></script>
<script src="planeMath.js"></script>
<script src="shapeFilter.js"></script>
<script src="intersectWithBox.js"></script>
<script src="shapeLogic.js"></script>
<script src="intersectionSet.js"></script>
<script src="canvas.js"></script>
<script src="log.js"></script>
<script src="structure.js"></script>
<script src="action.js"></script>
<script src="hash.js"></script>
<script src="buttons.js"></script>
<script src="main.js"></script>
<script>
(function(){
	Array.prototype.lastMin = function(amount){
		var result, m, min = Infinity;
		for(var i = 0; i<this.length;i++){
			m = amount(this[i]);
			if(m <= min){
				min = m;
				result = this[i];
			}
		}
		return result;
	};
	var sender = function(){
		var todo= [];
		var f = function(){
			var args = arguments;
			todo.map(function(g){
				g.apply(null, args);
			});
		};
		f.add = function(g){todo.push(g);return f;};
		f.remove = function(g){
			var index;
			if((index = todo.indexOf(g))!=-1){
				todo.splice(index,1);
			}
		};
		return f;
	};
	var copySet = function(origArray, mapper){
		var set = function(o, i){
			return {
				orig: o,
				copy:mapper(o,i)
			};
		};
		var all = origArray.map(set);
		return {
			copyOf: function(o){
				for(var i=0;i<all.length;i++){
					if(all[i].orig == o){
						return all[i].copy;
					}
				}
				return null;
			},
			originalOf:function(c){
				for(var i=0;i<all.length;i++){
					if(all[i].copy == c){
						return all[i].orig;
					}
				}
				return null;
			},
			allCopies: function(){return all.map(function(o){return o.copy;});},
			addFor: function(o){
				var filtered = all.filter(function(s){return s.orig == o;});
				if(filtered.length == 0){
					newSet = set(o, all.length);
					all.push(newSet);
					return newSet.copy;
				}else{
					return filtered[0].copy;
				}
			},
			removeFor:function(o){
				var index = -1;
				for(var i=0;i<all.length;i++){
					if(all[i].orig == o){
						index = i;
					}
				}
				if(index != -1){
					all.splice(index, 1);
				}
			}
		};
	};

	window.initGeometry({
		sender:sender,
		copySet:copySet,
		w:document.body.offsetWidth,
		h:document.body.offsetHeight,
		throttle:function(f, interval){
			var going = false;
			return function(){
				if(!going){
					var args = arguments;
					going = true;
					setTimeout(function(){
						f.apply(null, args);
						going = false;
					}, interval);
				}
			};
		},
		floatPattern:"-?\\d+(?:\\.\\d+)?(?:e-?\\d+)?",
		distinctArray:function(arr){
			var arr2 = arr.slice();
			var push = function(o){
				if(arr.indexOf(o) == -1){
					arr.push(o);
				}
			};
			arr.splice(0,arr.length);
			arr2.map(function(o){push(o);});
			return {
				arr:arr,
				push:push
			};
		}
	});
})();
</script>
</body>
</html>